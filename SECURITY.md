# üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ - Quick Fix

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: API –æ—Ç–∫—Ä—ã—Ç –Ω–∞—Ä—É–∂—É!

–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ —á—Ç–æ –≤–Ω–µ—à–Ω–∏–µ IP –∑–∞—Ö–æ–¥—è—Ç –Ω–∞–ø—Ä—è–º—É—é:
```
INFO: 199.45.155.74:51756 - "GET / HTTP/1.1" 200 OK
WARNING: Invalid HTTP request received
```

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï: Firewall –ø—Ä–∞–≤–∏–ª–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏ UFW (–µ—Å–ª–∏ –Ω–µ—Ç)
```bash
sudo apt install ufw -y
```

### 2. –ù–∞—Å—Ç—Ä–æ–π –ø—Ä–∞–≤–∏–ª–∞
```bash
# –†–∞–∑—Ä–µ—à–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã
sudo ufw allow 22/tcp      # SSH (–ù–ï –¢–†–û–ì–ê–ô!)
sudo ufw allow 80/tcp      # HTTP (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω Nginx)
sudo ufw allow 443/tcp     # HTTPS (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω Nginx)

# –ó–ê–ö–†–û–ô –ø–æ—Ä—Ç API –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö
sudo ufw deny 8001/tcp     # API –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏!

# –í–∫–ª—é—á–∏ firewall
sudo ufw enable
sudo ufw status
```

### 3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑–Ω—É—Ç—Ä–∏ Docker
```bash
# –í–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏ –≤—Å—ë –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
docker compose exec bot curl http://api:8000/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status":"healthy"}

# –°–Ω–∞—Ä—É–∂–∏ –ù–ï –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
curl http://YOUR_SERVER_IP:8001/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: Connection refused
```

---

## üõ° Docker Network Isolation

### –û–±–Ω–æ–≤–∏ docker-compose.yml

–£–±–µ—Ä–∏ –ø–æ—Ä—Ç—ã API –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞:

```yaml
# –ë–´–õ–û (–ü–õ–û–•–û):
api:
  ports:
    - "8001:8000"  # ‚Üê –û—Ç–∫—Ä—ã—Ç–æ –Ω–∞—Ä—É–∂—É!

# –°–¢–ê–õ–û (–•–û–†–û–®–û):
api:
  # –í–æ–æ–±—â–µ —É–±–µ—Ä–∏ ports, –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏
  # ports: —É–±—Ä–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
  expose:
    - "8000"  # ‚Üê –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏
```bash
docker compose down
docker compose up -d
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ß–¢–û –î–û–õ–ñ–ù–û –ë–´–¢–¨ –û–¢–ö–†–´–¢–û:
- ‚úÖ Port 22 (SSH)
- ‚úÖ Port 80 (Nginx, –µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ Port 443 (HTTPS, –µ—Å–ª–∏ –µ—Å—Ç—å)

### –ß–¢–û –î–û–õ–ñ–ù–û –ë–´–¢–¨ –ó–ê–ö–†–´–¢–û:
- ‚ùå Port 8001 (API)
- ‚ùå Port 5432/5433 (PostgreSQL)
- ‚ùå Port 6379 (Redis, –µ—Å–ª–∏ –±—É–¥–µ—Ç)

### –ü—Ä–æ–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã:
```bash
sudo netstat -tulpn | grep LISTEN
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `0.0.0.0:8001`!

---

## üö® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞

### 1. Fail2Ban (–∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞)
```bash
sudo apt install fail2ban -y
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

### 2. Rate Limiting –≤ Nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å)
```nginx
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

server {
    location /api {
        limit_req zone=api_limit burst=20;
        proxy_pass http://api:8000;
    }
}
```

### 3. –û–±–Ω–æ–≤–ª—è–π —Å–∏—Å—Ç–µ–º—É
```bash
# –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
sudo apt install unattended-upgrades -y
sudo dpkg-reconfigure -plow unattended-upgrades
```

---

## ‚úÖ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–°–Ω–∞—Ä—É–∂–∏ –ù–ï –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:**
```bash
curl http://YOUR_IP:8001/health  # Connection refused
```

**Telegram –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:**
- –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò Docker —Å–µ—Ç–∏ (http://api:8000)
- –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ!

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞—Ç–∞–∫

```bash
# –õ–æ–≥–∏ firewall
sudo tail -f /var/log/ufw.log

# –ö—Ç–æ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
sudo journalctl -u ufw -f
```

**–¢—ã —É–≤–∏–¥–∏—à—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏!**
